<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Přehrávač MP3 s poznámkami</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        audio { margin: 20px 0; }
        button { margin: 5px; padding: 10px; }
        textarea { margin: 10px 0; }
    </style>
</head>
<body>
    <h1 id="fileName">Přehrávač MP3 s poznámkami</h1>
    <audio id="audioPlayer" controls style="width: 100%;"></audio>
    <div>
        <button onclick="seekBackward()">-10s</button>
        <button onclick="playPause()">Play/Pause</button>
        <button onclick="seekForward()">+10s</button>
        <button onclick="changePlaybackRate(1)">1x</button>
        <button onclick="changePlaybackRate(1.5)">1.5x</button>
        <button onclick="changePlaybackRate(2)">2x</button>
    </div>
    <h3>Poznámky</h3>
    <textarea id="noteInput" placeholder="Zadejte poznámku..." style="width: 100%; height: 100px;"></textarea>
    <button onclick="addNote()">Přidat poznámku</button>
    <button onclick="exportNotes()">Exportovat poznámky</button>
    <button onclick="copyNotes()">Kopírovat poznámky</button>
    <ul id="notesList"></ul>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const mp3Url = urlParams.get('mp3');
        const audioPlayer = document.getElementById('audioPlayer');
        const fileNameDisplay = document.getElementById('fileName');

        if (mp3Url) {
            audioPlayer.src = mp3Url;
            const fileName = decodeURIComponent(mp3Url.split('/').pop().split('?')[0]);
            fileNameDisplay.textContent = `Přehráváte: ${fileName}`;
        } else {
            fileNameDisplay.textContent = 'Žádný MP3 soubor nenalezen.';
        }

        const notes = [];

        function addNote() {
            const noteInput = document.getElementById('noteInput');
            const currentTime = audioPlayer.currentTime;
            if (noteInput.value.trim() !== '') {
                notes.push({ time: formatTime(currentTime), text: noteInput.value });
                noteInput.value = '';
                renderNotes();
            }
        }

        function renderNotes() {
            const notesList = document.getElementById('notesList');
            notesList.innerHTML = '';
            notes.forEach((note) => {
                const listItem = document.createElement('li');
                listItem.textContent = `[${note.time}] ${note.text}`;
                notesList.appendChild(listItem);
            });
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function exportNotes() {
            const exportedNotes = notes.map((note) => `[${note.time}] ${note.text}`).join('\n');
            const blob = new Blob([exportedNotes], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'notes.txt';
            link.click();
        }

        function copyNotes() {
            const exportedNotes = notes.map((note) => `[${note.time}] ${note.text}`).join('\n');
            navigator.clipboard.writeText(exportedNotes).then(() => {
                alert('Poznámky byly zkopírovány do schránky!');
            });
        }

        function seekBackward() {
            audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 10);
        }

        function seekForward() {
            audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 10);
        }

        function playPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
        }

        function changePlaybackRate(rate) {
            audioPlayer.playbackRate = rate;
        }
    </script>
</body>
</html>
